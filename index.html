<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–®–∞–Ω—Å –Ω–∞ –≥—Ä–∞–Ω—Ç</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-4">
  <div class="max-w-md mx-auto bg-white rounded-2xl shadow-md p-6 space-y-6" id="app">
    <!-- –í—ã–±–æ—Ä —è–∑—ã–∫–∞ -->
    <div class="flex justify-end space-x-2">
      <button onclick="setLanguage('ru')" class="text-2xl">üá∑üá∫</button>
      <button onclick="setLanguage('kz')" class="text-2xl">üá∞üáø</button>
    </div>

    <!-- –®–∞–≥ 1: –û–±–ª–æ–∂–∫–∞ -->
    <div v-if="step === 1" class="space-y-4 text-center">
      <h1 class="text-2xl font-bold text-gray-900 leading-tight">
        {{ lang == 'ru' ? '–£–∑–Ω–∞–π —Å–≤–æ–∏ —à–∞–Ω—Å—ã –Ω–∞ –≥—Ä–∞–Ω—Ç' : '–ì—Ä–∞–Ω—Ç –∞–ª—É –º“Ø–º–∫—ñ–Ω–¥—ñ–≥—ñ“£—ñ–∑–¥—ñ –±—ñ–ª—ñ“£—ñ–∑' }}
      </h1>
      <p class="text-gray-600">
        {{ lang == 'ru' ? '–ü—Ä–æ–π–¥–∏ –∫–æ—Ä–æ—Ç–∫–∏–π —Ç–µ—Å—Ç –∏ —É–∑–Ω–∞–π, –∫—É–¥–∞ —Ä–µ–∞–ª—å–Ω–æ –ø–æ—Å—Ç—É–ø–∏—Ç—å –Ω–∞ –≥—Ä–∞–Ω—Ç' : '“ö—ã—Å“õ–∞ —Ç–µ—Å—Ç—Ç–µ–Ω ”©—Ç—ñ–ø, “õ–∞–π –ñ–û–û-“ì–∞ –≥—Ä–∞–Ω—Ç“õ–∞ —Ç“Ø—Å–µ –∞–ª–∞—Ç—ã–Ω—ã“£–¥—ã –±—ñ–ª' }}
      </p>
      <button @click="step = 2" class="bg-orange-500 text-white text-lg px-6 py-3 rounded-full hover:bg-orange-600 transition">
        {{ lang == 'ru' ? '–ü—Ä–æ–π—Ç–∏ —Ç–µ—Å—Ç' : '–¢–µ—Å—Ç—Ç—ñ –±–∞—Å—Ç–∞—É' }} ‚Üí
      </button>
      <img src="https://cdn-icons-png.flaticon.com/512/4140/4140048.png" alt="students" class="w-40 mx-auto mt-4"/>
    </div>

    <!-- –®–∞–≥ 2: –§–æ—Ä–º–∞ -->
    <div v-if="step === 2" class="space-y-4">
      <p class="text-gray-700 font-semibold">{{ lang == 'ru' ? '–®–∞–≥ 2 –∏–∑ 3' : '2-“õ–∞–¥–∞–º 3-—Ç–µ–Ω' }}</p>
      <h2 class="text-xl font-bold">{{ lang == 'ru' ? '–ó–∞–ø–æ–ª–Ω–∏ –∞–Ω–∫–µ—Ç—É' : '–ê–Ω–∫–µ—Ç–∞–Ω—ã —Ç–æ–ª—Ç—ã—Ä—ã“£—ã–∑' }}</h2>

      <div>
        <label class="block text-sm font-medium text-gray-700">
          {{ lang == 'ru' ? '–ì–æ—Ä–æ–¥' : '“ö–∞–ª–∞' }}
        </label>
        <select v-model="cityId" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
          <option disabled value="">{{ lang == 'ru' ? '–í—ã–±–µ—Ä–∏—Ç–µ –≥–æ—Ä–æ–¥' : '“ö–∞–ª–∞–Ω—ã —Ç–∞“£–¥–∞“£—ã–∑' }}</option>
          <option v-for="city in cities" :value="city.id">{{ city.name }}</option>
        </select>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700">
          {{ lang == 'ru' ? '–ë–∞–ª–ª—ã –ï–ù–¢' : '“∞–ë–¢ –±–∞–ª—ã' }}
        </label>
        <input type="number" v-model="score" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm" />
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700">
          {{ lang == 'ru' ? '–ö–æ–º–±–∏–Ω–∞—Ü–∏—è –ø—Ä–µ–¥–º–µ—Ç–æ–≤' : '–ü”ô–Ω –∫–æ–º–±–∏–Ω–∞—Ü–∏—è—Å—ã' }}
        </label>
        <select v-model="combinationId" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
          <option disabled value="">{{ lang == 'ru' ? '–í—ã–±–µ—Ä–∏—Ç–µ –∫–æ–º–±–∏–Ω–∞—Ü–∏—é' : '–ö–æ–º–±–∏–Ω–∞—Ü–∏—è–Ω—ã —Ç–∞“£–¥–∞“£—ã–∑' }}</option>
          <option v-for="combo in combinations" :value="combo.id">{{ combo.name }}</option>
        </select>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700">
          {{ lang == 'ru' ? '–°–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å' : '–ú–∞–º–∞–Ω–¥—ã“õ' }}
        </label>
        <select v-model="specialtyId" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
          <option disabled value="">{{ lang == 'ru' ? '–í—ã–±–µ—Ä–∏—Ç–µ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ—Å—Ç—å' : '–ú–∞–º–∞–Ω–¥—ã“õ—Ç—ã —Ç–∞“£–¥–∞“£—ã–∑' }}</option>
          <option v-for="spec in specialties" :value="spec.id">{{ spec.name }}</option>
        </select>
      </div>

      <div>
        <label class="block text-sm font-medium text-gray-700">
          {{ lang == 'ru' ? '–£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç' : '–£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç' }}
        </label>
        <select v-model="universityId" class="mt-1 block w-full rounded-md border-gray-300 shadow-sm">
          <option disabled value="">{{ lang == 'ru' ? '–í—ã–±–µ—Ä–∏—Ç–µ –≤—É–∑' : '–£–Ω–∏–≤–µ—Ä—Å–∏—Ç–µ—Ç—Ç—ñ —Ç–∞“£–¥–∞“£—ã–∑' }}</option>
          <option v-for="uni in universities" :value="uni.id">{{ uni.name }}</option>
        </select>
      </div>

      <button @click="submit" class="bg-blue-600 text-white w-full py-3 rounded-lg mt-4 hover:bg-blue-700 transition">
        {{ lang == 'ru' ? '–£–∑–Ω–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç' : '–ù”ô—Ç–∏–∂–µ–Ω—ñ –∫”©—Ä—É' }}
      </button>
    </div>

    <!-- –®–∞–≥ 3: –†–µ–∑—É–ª—å—Ç–∞—Ç -->
    <div v-if="step === 3" class="space-y-4">
      <p class="text-gray-700 font-semibold">{{ lang == 'ru' ? '–®–∞–≥ 3 –∏–∑ 3' : '3-“õ–∞–¥–∞–º 3-—Ç–µ–Ω' }}</p>
      <h2 class="text-xl font-bold">{{ lang == 'ru' ? '–†–µ–∑—É–ª—å—Ç–∞—Ç—ã' : '–ù”ô—Ç–∏–∂–µ' }}</h2>
      
      <div class="bg-gray-100 p-4 rounded-xl">
        <p><strong>{{ lang == 'ru' ? '–ü—Ä–æ—Ö–æ–¥–Ω–æ–π –±–∞–ª–ª:' : '”®—Ç—É –±–∞–ª—ã:' }}</strong> {{ result.passScore }}</p>
        <p><strong>{{ lang == 'ru' ? '–í–∞—à –±–∞–ª–ª:' : '–°—ñ–∑–¥—ñ“£ –±–∞–ª—ã“£—ã–∑:' }}</strong> {{ score }}</p>
        <p><strong>{{ lang == 'ru' ? '–®–∞–Ω—Å:' : '–ú“Ø–º–∫—ñ–Ω–¥—ñ–∫:' }}</strong> {{ result.chance }}</p>
        <!-- –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –ø–æ –∂–µ–ª–∞–Ω–∏—é -->
      </div>

      <button @click="step = 1" class="mt-4 bg-gray-200 px-4 py-2 rounded hover:bg-gray-300">
        {{ lang == 'ru' ? '–ü—Ä–æ–π—Ç–∏ —Å–Ω–æ–≤–∞' : '“ö–∞–π—Ç–∞ ”©—Ç—É' }}
      </button>
    </div>
  </div>

  <!-- Vue.js + –ª–æ–≥–∏–∫–∞ -->
  <script src="https://unpkg.com/vue@3.4.15/dist/vue.global.prod.js"></script>
  <script>
    const { createApp } = Vue;
    createApp({
      data() {
        return {
          step: 1,
          lang: 'ru',
          cityId: '',
          combinationId: '',
          specialtyId: '',
          universityId: '',
          score: '',
          result: {},
          cities: [],
          combinations: [],
          specialties: [],
          universities: []
        }
      },
      watch: {
        combinationId() {
          this.loadSpecialties();
        },
        specialtyId() {
          this.loadUniversities();
        }
      },
      methods: {
        setLanguage(l) {
          this.lang = l;
        },
        async loadInitial() {
          const [cities, combinations] = await Promise.all([
            fetch('https://api.moigrant.kz/cities').then(r => r.json()),
            fetch('https://api.moigrant.kz/combinations').then(r => r.json())
          ]);
          this.cities = cities;
          this.combinations = combinations;
        },
        async loadSpecialties() {
          if (!this.combinationId) return;
          const res = await fetch(`https://api.moigrant.kz/specialties?combination_id=${this.combinationId}`);
          this.specialties = await res.json();
        },
        async loadUniversities() {
          if (!this.specialtyId || !this.cityId) return;
          const res = await fetch(`https://api.moigrant.kz/universities?specialty_id=${this.specialtyId}&city_id=${this.cityId}`);
          this.universities = await res.json();
        },
        async submit() {
          const url = `https://api.moigrant.kz/statistics?combination_id=${this.combinationId}&specialty_id=${this.specialtyId}&university_id=${this.universityId}&city_id=${this.cityId}&score=${this.score}`;
          const res = await fetch(url);
          this.result = await res.json();
          this.step = 3;
        }
      },
      mounted() {
        this.loadInitial();
      }
    }).mount('#app');
  </script>
</body>
</html>
